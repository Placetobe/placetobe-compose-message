<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../placetobe-styles/placetobe-styles.html">
<link rel="import" href="../placetobe-textarea-box/placetobe-textarea-box.html">
<link rel="import" href="../placetobe-button/placetobe-button.html">
<link rel="import" href="../placetobe-card/placetobe-card.html">
<link rel="import" href="../caas-campaign-testimonials/caas-campaign-testimonials.html">

<!--
`placetobe-compose-message`
Placetobe element for composing a message

@demo demo/index.html 
-->

<dom-module id="placetobe-compose-message">
  <template>
    <style>
      :host {
        display: block;
      }
      placetobe-textarea-box {
        --iron-autogrow-textarea-max-height: {
          max-height: 100px;
        }
      }
      [hidden] {
        display: none;
      }
      
    </style>

    <caas-campaign-testimonials
      id="testimonials"
      campaign-id="[[campaignId]]"
      investor-id="[[investorId]]"
      invoice-number="[[invoiceNumber]]"
      relation-to-entrepeneur="[[relationToEntrepeneur]]"
      anonymous="false"
      api-endpoint="[[apiEndpoint]]"
      access-token="[[accessToken]]"
      motivational-message="[[messageString]]"
      on-campaign-testimonial-created="_handleMessageAdditionSuccessful"
    ></caas-campaign-testimonials>

    <placetobe-card title="[[cardTitle]]" id="compose-message">
      <template is="dom-if" if="{{!_messageSent}}">
        <article slot="main">
          <placetobe-textarea-box name="[[messageLabel]]" placeholder="[[messagePlaceholder]]" value="{{messageString}}" max-rows="[[maxRows]]"></placetobe-textarea-box>
        </article>
        <placetobe-button
          title="[[buttonTitle]]"
          slot="footer"
          disabled$="[[_emptyMessage]]"
          on-tap="addInvestorTestimonial"
        ><span>[[buttonTitle]]</span>
        </placetobe-button>
      </template>
      <template is="dom-if" if="{{_messageSent}}">
        <article slot="main">
          <p hidden$="{{!anonymous}}">Je bericht is op de pagina van de campagne te zien!</p>
          <p hidden$="{{anonymous}}">Je bericht is alleen voor de ondernemer te zien</p>
        </article>
      </template>
    </placetobe-card>

  </template>
  <script>
    Polymer({

      is: 'placetobe-compose-message',

      properties: {
        /**
         * Message (String) entered by user
        */ 
        messageString: {
          type: String,
          notify: true
        },
        /**
         * String displayed at the top of the card
        */ 
        cardTitle: {
          type: String
        },
        /**
         * String displayed in the button
        */        
        buttonTitle: {
          type: String
        },
        /**
         * Maximum amount of rows to be displayed at a time. Scrollbar will appear if amount of total rows increases this value.
         * Note: When users never hit `enter` (characterCode == 13) the textarea might grow bigger due to a bug.
        */
        maxRows: {
          type: Number
        },
        /**
         * Label on top of textfield reminder user what to write about
        */
        messageLabel: {
          type: String          
        },
        /**
         * Message to be displayed when user has not written anything yet
        */
        messagePlaceholder: {
          type: String                    
        },
        /**
        *  Id String of campaign
        */
        campaignId: {
          type: String
        },            
        /**
        * The Server side API endpoint
        */
        apiEndpoint: {
          type: String
        },
        /**
        * The access token (JSON web token) associated with the current user session
        */      
        accessToken: {
          type: String
        },
        /**
        * Number of invoice of investor (investorId) in campaign (campaignId)
        */
        invoiceNumber: {
          type: String
        },
        /**
        * Whether investor wants to stay anonymous or not
        */
        anonymous: {
          type: Boolean
        },     
        /**
        * Id String of logged in User
        */
        investorId: {
          type: String
        },    
        /**
        * Relationship type the investor has with the entepreneur
        */        
        relationToEntrepeneur: {
          type: String
        },

        _emptyMessage: {
          type: Boolean,
          computed: '_computeEmpty(messageString)'
        },

        _messageSent: {
          type: Boolean,
          value: false
        }
      },
      addInvestorTestimonial: function () {
        this.$.testimonials.addInvestorTestimonial()
      },

      _computeEmpty: function(value) {
        return (!value || value.length < 1);
      },

      _handleMessageAdditionSuccessful: function () {
        this.set('cardTitle', "Bedankt!")
        this.set('_messageSent', true)
      }
    });
  </script>
</dom-module>
